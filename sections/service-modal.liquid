<div id="service-modal" class="modal-overlay"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 1000; align-items: center; justify-content: center;">
    <div class="modal-content"
        style="background: #0f0f0f; border: 1px solid var(--border-color); padding: 2rem; border-radius: var(--radius-md); max-width: 500px; width: 90%; position: relative;">
        <button id="close-modal"
            style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;">&times;</button>

        <h2 id="modal-title" style="margin-bottom: 1rem;">Service Name</h2>
        <p id="modal-desc" style="color: var(--text-secondary); margin-bottom: 1.5rem;">Description goes here.</p>

        <h4 style="margin-bottom: 0.5rem; color: #fff;">What to Expect:</h4>
        <ul id="modal-expectations"
            style="list-style: none; color: var(--text-secondary); margin-bottom: 2rem; line-height: 1.6;">
            <!-- Populated via JS -->
        </ul>

        <div style="border-top: 1px solid var(--border-color); padding-top: 1.5rem;">

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <div>
                    <span style="display: block; font-size: 0.8rem; color: var(--text-secondary);">Investment</span>
                    <span id="modal-price" style="font-size: 1.2rem; font-weight: 700;">$997</span>
                </div>
            </div>

            <!-- Shopify Native Checkout Navigation -->
            <div id="payment-selection" style="display: flex; gap: 1rem; flex-direction: column;">
                <a id="modal-cta-link" href="#" class="btn btn-blue"
                    style="width: 100%; justify-content: center; display: flex; align-items: center; gap: 0.5rem; text-decoration: none; padding: 1rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5 22H19V6H5V22ZM7 8H17V20H7V8Z" fill="currentColor"/>
                        <path d="M9 4V6H15V4H9ZM8 2H16V8H8V2Z" fill="currentColor"/>
                    </svg>
                    Secure My Slot
                </a>

                <!-- Custom Buy Button for Growth Partner -->
                <div id="buy-button-container" style="display: none;">
                    <div id='product-component-1768688059768'></div>
                </div>

                <button id="btn-contact-custom" class="btn"
                    style="display: none; width: 100%; justify-content: center;">
                    Contact to Book
                </button>
            </div>

            <script type="text/javascript">
            /*<![CDATA[*/
            (function () {
              var scriptURL = 'https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js';
              if (window.ShopifyBuy) {
                if (window.ShopifyBuy.UI) {
                  ShopifyBuyInit();
                } else {
                  loadScript();
                }
              } else {
                loadScript();
              }
              function loadScript() {
                var script = document.createElement('script');
                script.async = true;
                script.src = scriptURL;
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(script);
                script.onload = ShopifyBuyInit;
              }
              function ShopifyBuyInit() {
                var client = ShopifyBuy.buildClient({
                  domain: 'yf2wvj-dw.myshopify.com',
                  storefrontAccessToken: '4f259f9f44486afb3c26f16e0cf54ff0',
                });
                window.shopifyBuyClient = client; // Expose client for debug/reuse
                ShopifyBuy.UI.onReady(client).then(function (ui) {
                  ui.createComponent('product', {
                    id: '9078390653154',
                    node: document.getElementById('product-component-1768688059768'),
                    moneyFormat: '%24%7B%7Bamount%7D%7D',
                    options: {
              "product": {
                "styles": {
                  "product": {
                    "@media (min-width: 601px)": {
                      "max-width": "100%",
                      "margin-left": "0px",
                      "margin-bottom": "0px"
                    }
                  },
                  "button": {
                    ":hover": {
                      "background-color": "#003fdd"
                    },
                    "background-color": "#0046f5",
                    ":focus": {
                      "background-color": "#003fdd"
                    },
                    "border-radius": "21px",
                    "padding": "1rem",
                    "width": "100%"
                  }
                },
                "buttonDestination": "checkout",
                "text": {
                  "button": "Buy now"
                },
                "contents": {
                  "img": false,
                  "title": false,
                  "price": false
                }
              },
              "productSet": {
                "styles": {
                  "products": {
                    "@media (min-width: 601px)": {
                      "margin-left": "-20px"
                    }
                  }
                }
              },
              "modalProduct": {
                "contents": {
                  "img": false,
                  "imgWithCarousel": true,
                  "button": false,
                  "buttonWithQuantity": true
                },
                "styles": {
                  "product": {
                    "@media (min-width: 601px)": {
                      "max-width": "100%",
                      "margin-left": "0px",
                      "margin-bottom": "0px"
                    }
                  },
                  "button": {
                    ":hover": {
                      "background-color": "#003fdd"
                    },
                    "background-color": "#0046f5",
                    ":focus": {
                      "background-color": "#003fdd"
                    },
                    "border-radius": "21px"
                  }
                },
                "text": {
                  "button": "Add to cart"
                }
              },
              "cart": {
                "styles": {
                  "button": {
                    ":hover": {
                      "background-color": "#003fdd"
                    },
                    "background-color": "#0046f5",
                    ":focus": {
                      "background-color": "#003fdd"
                    },
                    "border-radius": "21px"
                  }
                },
                "text": {
                  "total": "Subtotal",
                  "button": "Checkout"
                },
                "popup": false
              },
              "toggle": {
                "styles": {
                  "toggle": {
                    "background-color": "#0046f5",
                    ":hover": {
                      "background-color": "#003fdd"
                    },
                    ":focus": {
                      "background-color": "#003fdd"
                    }
                  }
                }
              }
            },
                  });
                });
              }
            })();
            /*]]>*/
            </script>

        </div>
    </div>
</div>

{% schema %}
{
  "name": "Service Modal",
  "settings": []
}
{% endschema %}

<script>
  window.ShopifyProductData = {
    {%- for product in collections['investment-plans'].products -%}
      "{{ product.handle }}": {
        "title": {{ product.title | json }},
        "price": {{ product.price | money | json }},
        "desc": {{ product.description | strip_html | truncatewords: 20 | json }},
        "url": "{{ product.url }}"
      }{% unless forloop.last %},{% endunless %}
    {%- endfor -%}
  };
</script>
